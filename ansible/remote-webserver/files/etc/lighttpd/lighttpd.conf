############################################################
##                                                        ##
##                Lighttpd Config                         ##
##                                                        ##
############################################################

############################################################
# Module config
############################################################
server.modules = (
	"mod_access",
	"mod_alias",
	"mod_compress",
 	"mod_redirect",
	"mod_auth",
	"mod_cgi",
	"mod_accesslog",
	"mod_evasive",
	"mod_rrdtool",
	"mod_status",
)

############################################################
# Basic Settings
############################################################

server.document-root           = "/var/www"
server.upload-dirs             = ( "/var/cache/lighttpd/uploads" )
server.errorlog                = "/var/log/lighttpd/error.log"
server.pid-file                = "/var/run/lighttpd.pid"
server.username                = "www-data"
server.groupname               = "www-data"
server.port                    = 8080

index-file.names               = ( "index.php", "index.html", "index.html", "index.cgi", "index.py" )
url.access-deny                = ( "~", ".inc" )
static-file.exclude-extensions = ( ".php", ".pl", ".fcgi" )

compress.cache-dir             = "/var/cache/lighttpd/compress/"
compress.filetype              = ( "application/javascript", "text/css", "text/html", "text/plain" )

############################################################ 
# Mime Types
############################################################

include_shell "/usr/share/lighttpd/create-mime.assign.pl"

############################################################
# Authentication
############################################################

auth.backend                   = "plain"
auth.backend.plain.userfile    = "lighttpd.user"
auth.backend.plain.groupfile   = "lighttpd.group"

auth.require                   = ( 
				"/admin" => (  
					"method"  => "basic",
				  	"realm"   => "admin panel",
				  	"require" => "user=admin"
				),
				"/api" => (  
					"method"  => "basic",
				  	"realm"   => "admin panel",
				  	"require" => "user=admin"
				    ),
				)

############################################################
# SSL
############################################################

$SERVER["socket"] == "0.0.0.0:443" {

	ssl.engine             = "enable"
	ssl.pemfile            = "/etc/lighttpd/lighttpd.pem"

	ssl.cipher-list        = "ECDHE-RSA-AES256-SHA384:AES256-SHA256:RC4:HIGH:!MD5:!aNULL:!EDH:!AESGCM"
	ssl.honor-cipher-order = "enable"
}

############################################################
# Logging
############################################################

accesslog.filename             = "/var/log/lighttpd/access.log"

############################################################
# CGI Scripting
############################################################

$HTTP["url"] =~ "^/admin/" {
	cgi.assign             = ( ".cgi" => "" )
}

cgi.assign                     = (
			           ".pl"  => "/usr/bin/perl",
				   ".py"  => "/usr/bin/python",
				)

############################################################
# Dir listing
############################################################

dir-listing.encoding           = "utf-8"
server.dir-listing             = "enable"

############################################################
# Rate limiting
############################################################

evasive.max-conns-per-ip       = 5
evasive.silent                 = "enabled" 

$HTTP["url"] =~ "^/admin/" {
  evasive.max-conns-per-ip       = 1
}

############################################################
# RRD 
############################################################

rrdtool.binary = "/usr/bin/rrdtool"
rrdtool.db-name = "/var/www/lighttpd.rrd"

############################################################
# Server Status 
############################################################ 

status.status-url = "/server-status"
status.config-url = "/server-config"
status.statistics-url = "/server-statistics"

############################################################ 
